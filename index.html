<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Calculadora avanzada</title>
	<link rel="stylesheet" href="static/style.css">
</head>
<body>
	<div class="calculadora">
		<div class="display">
			<div id="contenedor-subpant"><div id="subpant"></div></div>
			<div id="resultado">0</div>
		</div>
		<div class="botones">
           
			<button id="siete" onclick="agregarNumero(7)">7</button>
			<button id="ocho" onclick="agregarNumero(8)">8</button>
			<button id="nueve" onclick="agregarNumero(9)">9</button>
			<button id="division" onclick="agregarOperador('/')">÷</button>
            
			<button id="raiz" onclick="agregarOperador('sqrt')">√</button>
            <button id="cuatro" onclick="agregarNumero(4)">4</button>
			<button id="cinco" onclick="agregarNumero(5)">5</button>
			<button id="seis" onclick="agregarNumero(6)">6</button>
            
			<button id="multiplicacion" onclick="agregarOperador('*')">x</button>
			<button id="coseno" onclick="agregarOperador('log')">log</button>
            <button id="uno" onclick="agregarNumero(1)">1</button>
            <button id="dos" onclick="agregarNumero(2)">2</button>
            <button id="tres" onclick="agregarNumero(3)">3</button>

			
			<button id="resta" onclick="agregarOperador('-')">-</button>

			<button id="seno" onclick="agregarOperador('!')">n!</button>
            <button id="cero" onclick="agregarNumero(0)">0</button>
            <button id="decimal" onclick="agregarDecimal()">.</button>
            <button id="limpiar" onclick="limpiar(); limpiarsubpant()">C</button>
            
			<button id="suma" onclick="agregarOperador('+')">+</button>
            
            <button id="potencia" onclick="agregarOperador('^')">^</button>
			<button id="igual" onclick="calcular()">=</button>
            
            
		</div>
	</div>
	<script>
		// Obtener el elemento del resultado
		var resultado = document.getElementById("resultado");

		// Variables para almacenar los operandos, el operador y el estado de la calculadora
		var operando1 = "";
		var operando2 = "";
		var operador = "";
		var limpio = true;

		// Función para agregar un número al resultado
		function agregarNumero(numero) {
			// Si el resultado está limpio, reemplazarlo por el número
			
			if (limpio) {
				resultado.textContent = numero;
				agregarSubpant(numero);
				limpio = false;
			} else {
				// Si no, concatenar el número al resultado
				resultado.textContent += numero;
				agregarSubpant(numero);
			}
			
		}

		// Función para agregar un operador al resultado
		function agregarOperador(oper) {
            agregarSubpant(oper);
			// Si hay un operando1 y un operador, calcular el resultado parcial
			if (operando1 != "" && operador != "") {
				calcular();
			}
			// Guardar el resultado como operando1 y el operador como operador
			operando1 = resultado.textContent;
			operador = oper;
			// Limpiar el resultado para el siguiente operando
			limpiar();
		}

		// Función para agregar un punto decimal al resultado
		function agregarDecimal() {
			// Si el resultado está limpio, agregar un 0 antes del punto
			if (limpio) {
				resultado.textContent = "0.";
				agregarSubpant("0.");
				limpio = false;
			} else {
				// Si no, agregar el punto solo si no hay otro punto en el resultado
				if (resultado.textContent.indexOf(".") == -1) {
					resultado.textContent += ".";
					agregarSubpant(".");
				}
			}
		}

		function agregarSubpant(valor) {
			var pantalla = document.getElementById("subpant");
			pantalla.textContent += valor;
		}
		// Función para limpiar el resultado
		function limpiar() {
			// Poner el resultado en 0 y el estado en limpio
			resultado.textContent = "0";
			limpio = true;
		}

		function limpiarsubpant(){
			subpant.textContent= "";

		}

		// Función para calcular el resultado final
		function calcular() {
			// Si hay un operando1 y un operador, obtener el operando2 del resultado
			if (operando1 != "" && operador != "") {
				operando2 = resultado.textContent;
                console.log(operando1,operador,operando2);

				// Crear una petición al servidor con los operandos y el operador como parámetros
				var xhr = new XMLHttpRequest();
                // Codificar el operador antes de enviarlo
		        var operadorCodificado = encodeURIComponent(operador);
				xhr.open("GET", "/?operando1=" + operando1 + "&operando2=" + operando2 + "&operador=" + operadorCodificado, true);
				// Enviar la petición
				xhr.send();
				// Cuando se reciba la respuesta, mostrarla en el resultado
				xhr.onload = function() {
					resultado.textContent = xhr.responseText;
					subpant.textContent = xhr.responseText;
				};
				// Limpiar los operandos, el operador
				operando1 = "";
				operando2 = "";
				operador = "";;
			}
		}
	</script>
</body>
</html>